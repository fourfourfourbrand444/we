<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard | Artist Portal</title>
<link rel="stylesheet" href="dashboard.css">
</head>
<body>
<header>
  <h1>Artist Portal</h1>
  <nav>
    <a href="submissions.html">Submit Release</a>
    <a href="login.html" id="logout">Logout</a>
  </nav>
</header>

<div class="dashboard-container">
  <h2>My Submissions</h2>
  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Status</th>
        <th>Submitted At</th>
      </tr>
    </thead>
    <tbody id="list"></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBzUD7avh7vJfeSMRl2o9F09_qd-pl0dSg",
  authDomain: "usersubmissionsportal.firebaseapp.com",
  projectId: "usersubmissionsportal",
  storageBucket: "usersubmissionsportal.firebasestorage.app",
  messagingSenderId: "734783502459",
  appId: "1:734783502459:web:cfa2cc5de6976003b24ade",
  measurementId: "G-WCRN117P8P"
};


const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

document.getElementById("logout").addEventListener("click", async () => {
  await signOut(auth);
  window.location = "login.html";
});

onAuthStateChanged(auth, async (user) => {
  if (!user) { window.location = "login.html"; return; }

  const q = query(collection(db, "submissions"), where("userId", "==", user.uid));
  const snapshot = await getDocs(q);

  const list = document.getElementById("list");
  snapshot.forEach(doc => {
    const data = doc.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `
  <td><a href="view-submission.html?id=${doc.id}" style="color:#00ffcc;">${data.title || "No Title"}</a></td>
  <td class="status">${data.status}</td>
  <td>${data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString() : ""}</td>
`;
    list.appendChild(tr);
  });
});
</script>
</body>
</html>